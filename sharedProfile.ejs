<html>
<head>

    <title>Profile</title>
    <link rel="icon" href="/images/logo.png">

    <!--icons  -->
     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
     <link rel="stylesheet" href="css/materialize.min.css">
     <link rel="stylesheet" href="css/materialize.css">
     <link rel="stylesheet" href="css/navbar.css">
     <link rel="stylesheet" href="css/body.css">
     <link rel="stylesheet" href="css/myprofile.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



     <!-- Compiled and minified JavaScript -->
     <script type="text/javascript" src="jquery-3.2.1.min.js"></script>
     <script src="js/materialize.min.js"></script>
     <script src="js/materialize.js"></script>
     <script type="text/javascript" src="js/navbar.js"></script>

     <meta content="width=device-width, initial-scale=1" name="viewport" />

</head>



<body>
   
    <div class="topnav" id="myTopnav" style="width: 100%;">
        <a href="https://preskilet.herokuapp.com/" class="active"><i class="fa fa-fw fa-home"></i> Preskilet.com</a>
        <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="material-icons">apps</i>
        </a>
        </div>
    <br>

   <!-- profile card starts here -->

    <div class="row">
        <div class="col s12 m9 offset-m1">
            <div class="card white">
                <div class="card-content white-text " style="background: linear-gradient(-135deg, #36d1dc,#5b86e5 );">
                    <span class="card-title" ><img id="profileimage"  width="155" height="150" style=" border-radius: 50%; border: solid 3px whitesmoke;" src="images/833.gif"> 
                    </span>
                </div>
                <div class="card-action" style="padding-bottom: 5px;">
                    <img src="images/beginer.jpg" alt="images/833.gif" height="80px" width="80px" id="medal">
                    <div class="row" id="personalinfo">
                        <!-- personal info will appended here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- profile card ends here -->

        <!-- avarge card -->
       
        <div class="col s12 m2">
            <div class="card white">
                <div class="card-content black-text">
                    <div id="floatavg">
                        <!-- Float button with average Number will go here -->
                    </div>
                    <br>
                    <div id="progress_bar">
                        <!-- Progress bar will go here -->
                    </div> 
                    <br>
                    <div id="avgcard">
                        <div class="row ">
                            <div class="col m6 s5 offset-s1 blue darken-1" ><br><center><i class="material-icons  Medium" style="color:white">remove_red_eye </i></center> <center><b style="color:white" id="e">5</b></center></div>
                            <div class="col m6 s5 yellow darken-2"><br><center><i class="material-icons  Medium" style="color:white">record_voice_over </i></center> <center><b style="color:white" id="v">5</b></center></div>
                            <div class="col m6 s5 offset-s1 green darken-1"><br><center><i class="material-icons  Medium" style="color:white">portrait </i></center> <center><b style="color:white" id="c">5</b></center></div>
                            <div class="col m6 s5  red darken-1"><br><center><i class="material-icons  Medium" style="color:white">wb_incandescent </i></center> <center><b style="color:white" id="k">5</b></center></div>
                        </div>
                        <!-- all avg details go here -->
                    </div>
                </div>
                <div class="card-action blue darken-1" >
                    <center>
                    <a href="#" style="color: white;">Average</a>
                    <a href="#" style="color: white;">Rating</a>
                    </center>
                </div>
            </div>
        </div>
    </div>
        <!-- average ends -->


    <!-- video cards starts here -->
    <div class="row" id="parent">
        <!-- videos will be appended here -->
    </div>
    <!-- video cards ends here -->

    <!-- Modal Structure -->
    <div id="modal1" class="modal">
        <div class="modal-content">
        <h4>Profile Link </h4>
        <input type="text" id="link" style="color: #1565c0;" readonly></input>
        </div>
        <div class="modal-footer">
        <button class="waves-effect blue darken-1 btn" onclick="copyProfile()">Copy Link <i class="material-icons right">content_copy</i></button>
        </div>
    </div>
</body>

<script>

//hover to play video
function playVideo(x)
{
    x.children[0].children[0].play()
}

//hover to pause video
function normal(x)
{
    x.children[0].children[0].pause()
}

//function for copying link
function copyProfile() {
  var copyText = document.getElementById("link");
  copyText.select();
  document.execCommand("copy");
  M.toast({html: 'Link Copied',displayLength:2000})
}



$(document).ready(function(){

    //initializing modal
    $('.modal').modal();


    //ajax call onload of page asking for data
    $.ajax({
        url:'/mainpage/getSharedDetails',
        type:'GET',
        data:{
            'email':window.location.href.split('=')[1]
        },
        success:function(para){
            console.log(para)
            $("#profileimage"). attr("src",para.user.ipath);
            $("#avgrate").append(para.user.avgall);
            var w2;
            var l;
            //Setting Medal
            if(para.user.avgall == 0)
            {
                $('#floatavg').append('<center><a class="btn-floating btn-large red" >'+para.user.avgall+'</a></center>')
                w2 = '<div class="determinate" style="width: 0%;background-color: green;"></div>'
            } 
            else if(para.user.avgall <= 2)
            {
                $('#medal').attr("src", "images/bronze.png")
                $('#floatavg').append('<center><a class="btn-floating btn-large red" >'+para.user.avgall+'</a></center>')
                l = para.user.avgall * 20
                w2 = '<div class="determinate" style="width: '+l+'%;background-color: red;"></div>'
            }
            else if(para.user.avgall>2 && para.user.avgall<=4)
            {
                $('#medal').attr("src", "images/silver.png")
                $('#floatavg').append('<center><a class="btn-floating btn-large orange" >'+para.user.avgall+'</a></center>')
                l = para.user.avgall * 20
                w2 = '<div class="determinate" style="width: '+l+'%;background-color: orange;"></div>'
            }
            else
            {
                $('#medal').attr("src", "images/gold.png")
                $('#floatavg').append('<center><a class="btn-floating btn-large green" >'+para.user.avgall+'</a></center>')
                l = para.user.avgall * 20
                w2 = '<div class="determinate" style="width: '+l+'%;background-color: green;"></div>'
            }
            //setting medal ends here 
            var w1 = '<div class="progress" style="background-color:#b0bec5 ;">'
            var w3 = '</div>'
            var w = w1+w2+w3;
            $('#progress_bar').append(w)
            
            var str1 = "<p><b>Name :</b> "+para.user.name+"</p><p><b>Mail :</b> "+para.user.mail+""
            var str2 = "<p><a class='waves-effect blue darken-1 btn modal-trigger' href='#modal1'>Share Profile<i class='material-icons right'>share</i></a></p>"
            var str = str1+str2
            $("#personalinfo").append(str)

            $("#link").val("https://preskilet.herokuapp.com/mainpage/sharedProfile?mail="+para.user.mail)
            $('#e').html(para.user.avgeye)
            $('#v').html(para.user.avgvoice)
            $('#c').html(para.user.avgconfidence)
            $('#k').html(para.user.avgknowledge)

            for(let i = 0; i<para.video.length;i++)
            {   
                
                if(i%3 == 0)
                {
                    s1 ='<div class="col  m3 offset-m1 " ><div class="card z-depth-1" id="depthcard" onmouseover="playVideo(this)" onmouseout="normal(this)"><div class="card-image" >'
                }
                else 
                {
                    s1 ='<div class="col  m3 " ><div class="card z-depth-1" id="depthcard" onmouseover="playVideo(this)" onmouseout="normal(this)"><div class="card-image">'
                }
                console.log(s1)

                //var s1 ='<div class="col  m3" ><div class="card" ><div class="card-image" style="border:1px solid black;background:black;">'
                var s2 ='<video  class="activator" width="100%"  controls muted><source src="'+para.video[i].path+'" type="video/mp4"></video></div>'
                var s3 ='<div class="card-content" id="content"><span class="card-title grey-text text-darken-4">'+para.video[i].title+'<i class="material-icons right activator " style="cursor: pointer;">info</i></span><p><i class="material-icons left " style="color: #1565c0;">account_circle</i><a id='+para.video[i].mail+' style="cursor: pointer;color: #1565c0;">'+para.video[i].name+'</a></p><br>' 
                var s4 ='<span class="badge activator" style="float: left; padding-left: 0%; margin: 0%;cursor: pointer;"><i class="material-icons left">remove_red_eye</i>'+para.video[i].avgeye+'</span><span class="badge activator" style="float: left;padding-left: 0%;cursor: pointer;"><i class="material-icons left">record_voice_over</i>'+para.video[i].avgvoice+'</span><span class="badge activator" style="float: left;padding-left: 0%;cursor: pointer;"><i class="material-icons left">portrait</i>'+para.video[i].avgconfidence+'</span><span class="badge activator" style="float: left;padding-left: 0%;cursor: pointer;"><i class="material-icons left">wb_incandescent</i>'+para.video[i].avgknowledge+'</span></div>'
                var s5 ='<div class="card-reveal" id="reveal"><span class="card-title black-text text-darken-4">Grade Presentation<i class="material-icons right">close</i></span>'
                var s6 =''
                var s7 = '<br><a href="https://preskilet.herokuapp.com/" class="waves-effect green btn"><i class="material-icons right">open_in_browser</i>Visit Preskilate.com</a><br><br><b style="color:red">To Grade Video Please click above button to visit www.preskilet.com</b><br>'
                var s8 = '<p><b>Description : </b>'+para.video[i].description+'</p><p><b>Mail : </b>'+para.video[i].mail+'</p></div></div></div>'
                var str =s1+s2+s3+s4+s5+s6+s7+s8;
                $('#parent').append(str)
                
            }
        }
    })
})
</script>
</html>